<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能监控平台</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
    <script src="./js/2.6.14_vue.min.js"></script>
    <script src="./js/EasyPlayer-pro.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0a1128 0%, #1e3c72 100%);
            color: #00d4ff;
            overflow: hidden;
            /* Ensure no overall scrollbar */
            height: 100vh;
            font-size: 12px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 123, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 255, 127, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(90deg, transparent 98%, rgba(0, 212, 255, 0.1) 100%),
                linear-gradient(0deg, transparent 98%, rgba(0, 212, 255, 0.1) 100%);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }

        .header {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 123, 255, 0.2) 100%);
            border: 1px solid #00d4ff;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            padding: 0 30px;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.3), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }

            100% {
                left: 100%;
            }
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 4px;
            text-shadow: 0 0 20px #00d4ff;
            flex-grow: 1;
            text-align: center;
            margin-left: 0;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .back-button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            color: #000;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .back-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .back-button:hover::before {
            left: 100%;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 25px rgba(0, 212, 255, 0.8);
        }

        .left-panel,
        .right-panel {
            background: rgba(0, 50, 100, 0.3);
            border: 1px solid #00d4ff;
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            /* For inner scrolling content */
            display: flex;
            flex-direction: column;
            /* justify-content: space-between;  Removed to allow modules to define their own height, and prevent gaps */
        }

        /* Module sections for consistent styling and dividers */
        .module-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
            position: relative;
        }

        .module-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .module-section::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 10%;
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(0, 212, 255, 0.5) 20%,
                    rgba(0, 212, 255, 0.5) 80%,
                    transparent 100%);
        }

        .left-panel .module-section:last-child,
        .right-panel .module-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }


        .left-panel::before,
        .right-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(0, 212, 255, 0.05), transparent);
            animation: panelScan 8s linear infinite;
        }

        @keyframes panelScan {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .main-content {
            display: grid;
            grid-template-rows: 1fr;
            gap: 10px;
        }

        .video-section {
            background: rgba(0, 50, 100, 0.3);
            border: 1px solid #00d4ff;
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-width: 400px;
        }

        .video-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            animation: scanLine 3s linear infinite;
        }

        @keyframes scanLine {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .video-frame {
            flex-grow: 1;
            background: #1a1a2e;
            border: 2px solid #00d4ff;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow:
                inset 0 0 50px rgba(0, 212, 255, 0.1),
                0 0 30px rgba(0, 212, 255, 0.2);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            min-width: 400px;
            min-height: 250px;
            aspect-ratio: 16/9;
        }

        .video-frame::before {
            content: none;
        }

        @keyframes videoGrid {
            0% {
                transform: none;
            }

            100% {
                transform: none;
            }
        }

        .video-overlay {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            color: #00d4ff;
            border: 1px solid rgba(0, 212, 255, 0.3);
            z-index: 2;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 10px 0;
            margin-top: 10px;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
        }

        .control-btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            color: #000;
            padding: 6px 15px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 15px rgba(0, 212, 255, 0.6);
        }

        .section-title {
            color: #00d4ff;
            font-size: 14px;
            margin-bottom: 10px;
            /* Reduced margin */
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .video-title-bar {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 0;
            position: relative;
        }

        .video-title-bar .time-display {
            margin-bottom: 0;
            margin-left: 0;
            font-size: 12px;
            color: #00d4ff;
            background: none;
            border: none;
            padding: 0 40px 0 20px;
            display: flex;
            align-items: center;
            position: relative;
        }

        .section-title::after {
            content: '>>>';
            position: absolute;
            right: 0;
            top: 0;
            color: #00d4ff;
            font-size: 10px;
            animation: blink 2s infinite;
        }

        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0.3;
            }
        }

        /* Treeview styles */
        .tree-view-wrapper {
            height: 190px;
            /* Calc height: 100vh - header_height - panel_padding_top/bottom - (module_section_margin_bottom + padding_bottom + section_title_height + section_title_margin_bottom) * 2 - cpu_labels_height */
            /* Rough estimate: 100vh - 60px - 30px - (15+15+22+10)*2 - 15px */
            max-height: calc(100vh - 60px - 30px - 2 * 62px - 15px - 120px - 15px - 80px);
            overflow-y: auto;
            padding-right: 5px;
        }

        .tree-view ul {
            list-style-type: none;
            padding-left: 15px;
            margin: 0;
        }

        .tree-view li {
            position: relative;
            padding: 2px 0;
            /* Reduced padding */
        }

        .tree-view li::before {
            content: ' ';
            position: absolute;
            left: 5px;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: rgba(0, 212, 255, 0.3);
        }

        .tree-view li:last-child::before {
            height: 12px;
        }

        .tree-view li::after {
            content: ' ';
            position: absolute;
            left: 5px;
            top: 10px;
            /* Adjusted position */
            width: 8px;
            height: 1px;
            background-color: rgba(0, 212, 255, 0.3);
        }

        .tree-view .node-content {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            margin: 2px 0;
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid #00d4ff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
            position: relative;
            z-index: 1;
        }

        .tree-view .node-content:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }

        .tree-view .node-content .indicator {
            margin-right: 6px;
            width: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .tree-view .node-content .indicator.collapsed {
            transform: rotate(-90deg);
        }

        .tree-view .nested {
            display: none;
            padding-left: 15px;
        }

        .tree-view .nested.active {
            display: block;
        }

        .tree-view .indicator {
            display: inline-block;
            width: 12px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .tree-view .indicator.collapsed {
            transform: rotate(-90deg);
        }

        .cpu-chart-container {
            height: 120px;
            background: rgba(0, 212, 255, 0.1);
            /* Light blue background */
            border: 1px solid #00d4ff;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
            /* Adjusted spacing */
        }

        .storage-chart-container {
            height: 80px;
            background: rgba(0, 212, 255, 0.1);
            /* Light blue background */
            border: 1px solid #00d4ff;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }

        .storage-x-axis-labels {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            font-size: 8px;
            color: #00d4ff;
            text-align: center;
            display: flex;
            justify-content: space-around;
            padding: 0 10px;
        }


        .gauge-wrapper {
            display: flex;
            flex-direction: row;
            align-items: center;
            text-align: left;
            /* Left text under gauge */
        }

        .gauge-container {
            /* ECharts gauge container */
            width: 80px;
            height: 80px;
            margin: auto;
        }

        .stat-text {
            display: flex;
            /* Arrange text horizontally */
            flex-direction: column;
            /* Stack them vertically for clarity */
            justify-content: center;
            gap: 2px;
            /* Space between lines of text */
            font-size: 12px;
            color: #00d4ff;
            line-height: 1.2;
            white-space: nowrap;
        }

        .alert-list-wrapper {
            /* Calc height: 100vh - header - panel_padding - section_title - device_status_gauge_area - (module_section_margin_bottom + padding_bottom + section_title_height + section_title_margin_bottom) */
            /* Rough estimate: 100vh - 60px - 30px - 22px - 120px - (15+15+22+10) */
            max-height: calc(100vh - 60px - 30px - 22px - 120px - 62px - 30px);
            overflow-y: auto;
            padding-right: 5px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 6px 0;
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid #00d4ff;
            border-radius: 4px;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateX(3px);
        }

        .alert-item::before {
            content: '';
            position: absolute;
            right: 5px;
            top: 5px;
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            animation: alertBlink 2s infinite;
        }

        @keyframes alertBlink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0;
            }
        }

        .alert-icon {
            width: 40px;
            height: 50px;
            background: #00d4ff;
            border-radius: 4px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .alert-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .alert-info {
            flex: 1;
        }

        .alert-title {
            font-size: 14px;
            color: #00d4ff;
            margin-bottom: 2px;
        }

        .alert-time {
            font-size: 11px;
            color: rgba(0, 212, 255, 0.7);
        }

        .alert-location {
            font-size: 11px;
            color: #00d4ff;
            margin-top: 2px;
        }

        .time-display {
            text-align: center;
            font-size: 12px;
            color: #00d4ff;
            margin-bottom: 15px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            position: relative;
            z-index: 1;
            flex-shrink: 0;
        }

        /* Custom scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #0099cc;
        }

        #storage-bar-echart {
            background: #122b4d;
            border-radius: 10px;
            box-shadow: 0 0 10px #00d4ff44 inset;
            border: 1px solid #00d4ff;
        }

        .storage-bar-outer {
            position: relative;
            width: 100%;
            height: 80px;
            background: #122b4d;
            border-radius: 10px;
            box-shadow: 0 0 10px #00d4ff44 inset;
            border: 1px solid #00d4ff;
            overflow: hidden;
        }

        .storage-bar-inner {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            height: 60px;
            background: linear-gradient(45deg, transparent 49%, #00d4ff 50%, transparent 51%);
            background-size: 10px 10px;
            animation: chartMove 5s linear infinite;
            transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes chartMove {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 100px 0;
            }
        }

        .storage-bar-label {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #00d4ff;
            font-size: 18px;
            font-weight: bold;
            z-index: 2;
            text-shadow: 0 0 8px #00d4ff88;
        }

        .screen-switch {
            display: flex;
            gap: 8px;
            padding-right: 30px;
            align-items: center;
        }

        .screen-btn,
        .fullscreen-btn,
        .control-icon {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            color: #00d4ff;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            border: none;
            background: none;
        }

        .screen-btn svg,
        .fullscreen-btn svg,
        .control-icon svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
            transition: all 0.2s;
        }

        .screen-btn.active,
        .screen-btn:hover,
        .fullscreen-btn:hover,
        .control-icon:hover {
            color: #00d4ff;
            transform: scale(1.1);
        }

        .screen-btn.active svg,
        .screen-btn:hover svg,
        .fullscreen-btn:hover svg,
        .control-icon:hover svg {
            fill: #00d4ff;
            filter: drop-shadow(0 0 4px #00d4ff);
        }

        .divider {
            width: 1px;
            height: 20px;
            background-color: #00d4ff;
            margin: 0 8px;
            opacity: 0.5;
        }

        .video-frame.screen-1 {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr;
            gap: 0;
        }

        .video-frame.screen-4 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 2px;
        }

        .player-box {
            width: 100%;
            height: 100%;
            background: #000;
            border: 1px solid #00d4ff;
            border-radius: 4px;
            position: relative;
        }

        /* 响应式布局样式 */
        @media screen and (max-width: 1400px) {
            .container {
                grid-template-columns: 250px 1fr 300px;
            }

            .header {
                padding: 0 20px;
            }

            .header h1 {
                font-size: 24px;
                margin-left: 0;
            }

            .video-frame {
                min-width: 350px;
            }

            .cpu-chart-container {
                height: 100px;
            }
        }

        @media screen and (max-width: 1200px) {
            .container {
                grid-template-columns: 200px 1fr 250px;
            }

            .header {
                padding: 0 15px;
            }

            .header h1 {
                font-size: 20px;
                margin-left: 0;
            }

            .section-title {
                font-size: 13px;
            }

            .control-btn {
                padding: 4px 12px;
                font-size: 11px;
            }

            .cpu-chart-container {
                height: 90px;
            }

            .gauge-wrapper .stat-text {
                display: none !important;
            }
        }

        @media screen and (max-width: 992px) {
            .container {
                grid-template-columns: 180px 1fr 200px;
                gap: 5px;
                padding: 5px;
            }

            .header {
                padding: 0 10px;
            }

            .header h1 {
                font-size: 18px;
                margin-left: 0;
            }

            .back-button {
                padding: 6px 15px;
                font-size: 12px;
            }

            .video-title-bar .time-display {
                display: none;
            }

            .left-panel,
            .right-panel {
                padding: 10px;
            }

            .module-section {
                margin-bottom: 15px;
                padding-bottom: 15px;
            }

            .gauge-wrapper .stat-text {
                display: none !important;
            }

            .cpu-chart-container {
                height: 80px;
            }
        }

        @media screen and (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                gap: 5px;
                overflow-y: auto;
            }

            .header {
                padding: 0 15px;
                height: 50px;
                margin-bottom: 5px;
            }

            .header h1 {
                font-size: 16px;
                letter-spacing: 2px;
            }

            .back-button {
                padding: 4px 12px;
                font-size: 11px;
            }

            .left-panel,
            .right-panel {
                display: block;
                height: 550px;
            }

            .main-content {
                grid-column: 1 / -1;
            }

            .video-section {
                min-width: 100%;
            }

            .video-frame {
                min-width: 100%;
                aspect-ratio: 16/9;
            }

            .screen-switch {
                padding-right: 10px;
            }

            .tree-view-wrapper {
                height: 125px;
            }

            .cpu-chart-container {
                height: 140px;
            }

            .gauge-wrapper .stat-text {
                display: flex !important;
                font-size: 10px;
            }

            /* 小屏幕下隐藏section-title的after元素 */
            .section-title::after {
                display: none;
            }
        }

        /* 添加打印样式 */
        @media print {
            .container {
                display: block;
            }

            .header,
            .left-panel,
            .right-panel {
                display: none;
            }

            .main-content {
                width: 100%;
            }

            .video-section {
                border: none;
                background: none;
            }
        }

        /* 设备状态样式 */
        .device-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
        }

        .status-offline {
            background-color: #ff4444;
        }

        .status-standby {
            background-color: #ffbb33;
        }

        .status-started {
            background-color: #00C851;
        }

        .node-content {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            margin: 2px 0;
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid #00d4ff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 11px;
            position: relative;
            z-index: 1;
        }

        .node-content:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }

        .node-content.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-icon img {
            width: 20px;
            height: 20px;
            filter: invert(48%) sepia(79%) saturate(2476%) hue-rotate(190deg) brightness(118%) contrast(119%);
        }

        .control-icon:hover img {
            filter: invert(48%) sepia(79%) saturate(2476%) hue-rotate(190deg) brightness(118%) contrast(119%) drop-shadow(0 0 4px #00d4ff);
        }
    </style>
</head>

<body>
    <div class="container" id="app">
        <div class="header">
            <button class="back-button">后台</button>
            <h1>智能监控平台</h1>
        </div>
        <div class="left-panel">
            <div class="module-section">
                <div class="section-title">设备列表</div>
                <div class="tree-view-wrapper" style="max-height:190px; overflow-y:auto">
                    <div class="tree-view">
                        <ul>
                            <template v-for="group in deviceGroups">
                                <li v-if="group.devices.length > 0">
                                    <div class="node-content parent" @click="toggleGroup(group.id)">
                                        <span class="indicator"
                                            :class="{ 'collapsed': !(groupStates[group.id] && groupStates[group.id].expanded) }">▼</span>
                                        <span>{{ group.name }}</span>
                                    </div>
                                    <ul class="nested"
                                        :class="{ 'active': groupStates[group.id] && groupStates[group.id].expanded }">
                                        <li v-for="device in group.devices" :key="device.deviceid">
                                            <div class="node-content" :class="{ 'disabled': !device.online }"
                                                @click="handleDeviceClick(device)">
                                                <span class="device-status"
                                                    :class="getDeviceStatusClass(device)"></span>
                                                <span>{{ device.devicename }}</span>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="module-section">
                <div class="section-title" style="display:flex;
                                align-items:center;
                                gap: 50px;
                                justify-content: flex-start">
                    内存/CPU
                </div>
                <div id="cpu-chart" class="cpu-chart-container"></div>
            </div>
            <div class="module-section">
                <div class="section-title">存储</div>
                <div class="storage-bar-outer">
                    <div class="storage-bar-inner" id="storage-bar-inner"></div>
                    <div class="storage-bar-label" id="storage-bar-label">45%</div>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="video-section" id="app">
                <div class="section-title video-title-bar">
                    <span>实时调阅</span>
                    <span class="time-display" style="margin-left: 20px;">{{ currentTime }}</span>
                    <div class="screen-switch" style="margin-left:auto;">
                        <span class="control-icon" @click="onPlayer">
                            <img src="public/replay.svg" alt="重连" style="width: 20px; height: 20px;">
                        </span>
                        <span class="control-icon" @click="onStop">
                            <img src="public/OFF.svg" alt="重置" style="width: 20px; height: 20px;">
                        </span>
                        <div class="divider"></div>
                        <span v-for="item in [1,4]" :key="item" :class="['screen-btn', {active: screenCount===item}]"
                            @click="switchScreen(item)">
                            <svg v-if="item === 1" viewBox="0 0 1024 1024" version="1.1"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M960 920c0 22-18 40-40 40H104c-22 0-40-18-40-40V104c0-22 18-40 40-40h816c22 0 40 18 40 40v816z">
                                </path>
                            </svg>
                            <svg v-else viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M480 96v288c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h288c53 0 96 43 96 96zM1024 96v288c0 53-43 96-96 96H640c-53 0-96-43-96-96V96c0-53 43-96 96-96h288c53 0 96 43 96 96zM480 640v288c0 53-43 96-96 96H96c-53 0-96-43-96-96V640c0-53 43-96 96-96h288c53 0 96 43 96 96zM1024 640v288c0 53-43 96-96 96H640c-53 0-96-43-96-96V640c0-53 43-96 96-96h288c53 0 96 43 96 96z">
                                </path>
                            </svg>
                        </span>
                        <div class="divider"></div>
                        <span class="fullscreen-btn" @click="setFullscreen">
                            <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M368.896 192H224a32 32 0 0 0-32 32v137.888a32 32 0 0 0 64 0V256h112.896a32 32 0 0 0 0-64zM784.864 192H640a32 32 0 1 0 0 64h112.864v105.888a32 32 0 1 0 64 0V224a32 32 0 0 0-32-32zM368.896 777.92H256V672a32 32 0 1 0-64 0v137.92a32 32 0 0 0 32 32h144.896a32 32 0 1 0 0-64zM784.864 640a32 32 0 0 0-32 32v105.92H640a32 32 0 1 0 0 64h144.864a32 32 0 0 0 32-32V672a32 32 0 0 0-32-32z">
                                </path>
                                <path
                                    d="M912 48h-800c-35.296 0-64 28.704-64 64v800c0 35.296 28.704 64 64 64h800c35.296 0 64-28.704 64-64v-800c0-35.296-28.704-64-64-64z m-800 864v-800h800l0.064 800H112z">
                                </path>
                            </svg>
                        </span>
                    </div>
                </div>
                <div class="video-frame" :class="'screen-'+screenCount">
                    <div v-for="n in screenCount" :key="n" :id="'easyplayer-container-'+n" class="player-box"
                        @click="handleScreenClick(n-1)"></div>
                </div>
            </div>
        </div>
        <div class="right-panel">
            <div class="module-section">
                <div class="section-title">设备状态</div>
                <div style="display: flex;
                                justify-content: space-around;
                                align-items: flex-start;
                                padding: 0">
                    <div class="gauge-wrapper">
                        <div id="gauge-startup" class="gauge-container"></div>
                        <div class="stat-text" style="display:flex;
                                        gap:10px;
                                        justify-content:center">
                            <span>启动: 0</span> <span>待机: 0</span>
                        </div>
                    </div>
                    <div class="gauge-wrapper">
                        <div id="gauge-online" class="gauge-container"></div>
                        <div class="stat-text" style="display:flex;
                                        gap:10px;
                                        justify-content:center">
                            <span>在线: 0</span> <span>离线: 0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="module-section">
                <div class="section-title">预警抓拍</div>
                <div class="alert-list-wrapper">
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">烟火告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:44:19</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">安全帽告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:39:30</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">烟火告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:34:19</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">安全帽告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:29:30</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">烟火告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:24:17</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">入侵告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:20:00</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                    <div class="alert-item">
                        <div class="alert-icon">
                            <img src="public/bus.jpg" alt="Alert Icon">
                        </div>
                        <div class="alert-info">
                            <div class="alert-title">入侵告警</div>
                            <div class="alert-time">抓拍时间: 2025-04-07 14:15:00</div>
                            <div class="alert-location">布点名称: 告警设备</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // 实时更新时间
        function updateTime() {
            const now = new Date();
            const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            const timeString = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${weekdays[now.getDay()]} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

            const timeDisplay = document.querySelector('.time-display');
            if (timeDisplay) {
                timeDisplay.textContent = timeString;
            }
        }

        // 每秒更新时间
        setInterval(updateTime, 1000);

        // 初始化时间
        updateTime();

        // 移除这段代码，因为它与Vue的折叠功能冲突
        // Treeview functionality
        // document.querySelectorAll('.tree-view .node-content.parent').forEach(node => {
        //     node.addEventListener('click', function (event) {
        //         event.stopPropagation(); 
        //         this.querySelector('.indicator').classList.toggle('collapsed');
        //         const nestedUl = this.nextElementSibling;
        //         nestedUl.classList.toggle('active');
        //     });
        // });

        document.querySelectorAll('.tree-view .node-content').forEach(node => {
            node.addEventListener('click', function () {
                document.querySelectorAll('.tree-view .node-content').forEach(n => {
                    n.style.background = 'rgba(0, 212, 255, 0.1)';
                    n.style.borderLeftColor = '#00d4ff'; /* Reset border color */
                });
                this.style.background = 'rgba(0, 212, 255, 0.3)';
                this.style.borderLeftColor = '#00ff00'; /* Highlight with green border */
            });
        });

        // ECharts for CPU/Memory Chart
        const cpuChartDom = document.getElementById('cpu-chart');
        const cpuChart = echarts.init(cpuChartDom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        let cpuOption;

        const cpuData = [];
        const memoryData = [];
        const timeData = [];

        function generateCpuMemoryData() {
            const now = new Date();
            const timeStr = String(now.getHours()).padStart(2, '0') + ':' +
                String(now.getMinutes()).padStart(2, '0') + ':' +
                String(now.getSeconds()).padStart(2, '0');

            timeData.push(timeStr);
            cpuData.push(parseFloat((Math.random() * 30 + 30).toFixed(1))); // CPU usage 30-60%
            memoryData.push(parseFloat((Math.random() * 40 + 40).toFixed(1))); // Memory usage 40-80%

            // Keep only last 10 data points
            if (timeData.length > 10) {
                timeData.shift();
                cpuData.shift();
                memoryData.shift();
            }
        }

        cpuOption = {
            color: ['#00ff00', '#ffff00'],
            tooltip: {
                trigger: 'axis',
                confine: true,
                textStyle: {
                    color: '#fff',
                    fontSize: 10,
                },
                backgroundColor: 'rgba(0, 0, 0, 0.2)',
                formatter: function (params) {
                    let tooltipContent = params[0].name + '<br />';
                    params.forEach(function (item) {
                        const colorSpan = `<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${item.color};"></span>`;
                        tooltipContent += colorSpan + item.seriesName + ': ' + item.value + '%<br />';
                    });
                    return tooltipContent;
                }
            },
            legend: {
                data: ['内存', 'CPU'],
                textStyle: {
                    color: '#fff',
                    fontSize: 10,
                }
            },
            toolbox: {
                feature: {
                    saveAsImage: {
                        title: ''
                    },
                }
            },
            grid: {
                top: '10%',
                left: '3%',
                right: '10%',
                bottom: '5%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: timeData,
                axisLabel: {
                    color: '#00d4ff',
                    fontSize: 10,
                    formatter: function (value) {
                        return value.substring(3);
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: 'rgba(0, 212, 255, 0.5)'
                    }
                },
                axisTick: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    formatter: '{value} %',
                    color: '#00d4ff',
                    fontSize: 10
                },
                splitLine: {
                    lineStyle: {
                        color: 'rgba(0, 212, 255, 0.2)'
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: 'rgba(0, 212, 255, 0.5)'
                    }
                },
                min: 0,
                max: 100
            },
            series: [
                {
                    name: '内存',
                    type: 'line',
                    smooth: true,
                    symbol: 'none',
                    lineStyle: {
                        color: '#00ff00'
                    },
                    areaStyle: {
                        opacity: 0.5,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(0, 255, 0, 0.4)'
                        }, {
                            offset: 1,
                            color: 'rgba(0, 255, 0, 0)'
                        }])
                    },
                    data: memoryData
                },
                {
                    name: 'CPU',
                    type: 'line',
                    smooth: true,
                    symbol: 'none',
                    lineStyle: {
                        color: '#ffff00'
                    },
                    areaStyle: {
                        opacity: 0.5,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(255, 255, 0, 0.4)'
                        }, {
                            offset: 1,
                            color: 'rgba(255, 255, 0, 0)'
                        }])
                    },
                    data: cpuData
                }
            ]
        };

        // 添加窗口大小变化监听
        window.addEventListener('resize', function () {
            cpuChart.resize();
        });

        // 确保在DOM加载完成后初始化图表
        document.addEventListener('DOMContentLoaded', function () {
            // 初始化CPU图表
            const cpuChartDom = document.getElementById('cpu-chart');
            if (cpuChartDom) {
                const cpuChart = echarts.init(cpuChartDom);

                // 初始化数据
                for (let i = 0; i < 10; i++) {
                    generateCpuMemoryData();
                }

                cpuChart.setOption(cpuOption);

                // 添加定时更新
                setInterval(() => {
                    generateCpuMemoryData();
                    cpuChart.setOption({
                        xAxis: {
                            data: timeData
                        },
                        series: [{
                            data: memoryData
                        }, {
                            data: cpuData
                        }]
                    });
                }, 3000);

                // 添加窗口大小变化监听
                window.addEventListener('resize', function () {
                    cpuChart.resize();
                });
            }

            // 初始化仪表盘
            const startupGaugeDom = document.getElementById('gauge-startup');
            const onlineGaugeDom = document.getElementById('gauge-online');

            if (startupGaugeDom && onlineGaugeDom) {
                const startupGaugeChart = echarts.init(startupGaugeDom);
                const onlineGaugeChart = echarts.init(onlineGaugeDom);

                // 初始化仪表盘数据
                const startupPercentage = '0.0';
                const onlinePercentage = '0.0';

                startupGaugeChart.setOption(createGaugeOption(startupPercentage, '#00d4ff'));
                onlineGaugeChart.setOption(createGaugeOption(onlinePercentage, '#00ff00'));

                // 添加窗口大小变化监听
                window.addEventListener('resize', function () {
                    startupGaugeChart.resize();
                    onlineGaugeChart.resize();
                });

                // 存储图表实例到全局变量
                window.startupGaugeChart = startupGaugeChart;
                window.onlineGaugeChart = onlineGaugeChart;
            }
        });

        // 存储进度条动态更新
        function updateStorageBar(percent) {
            const bar = document.getElementById('storage-bar-inner');
            const label = document.getElementById('storage-bar-label');
            bar.style.width = percent + '%';
            label.textContent = percent + '%';
        }
        setInterval(() => {
            const percent = Math.floor(Math.random() * 31) + 40; // 40-50之间的随机数
            updateStorageBar(percent);
        }, 5000); // 每5秒更新一次
        updateStorageBar(45); // 初始值设为45%

        // ECharts for Startup Gauge
        const createGaugeOption = (value, color) => ({
            series: [
                {
                    type: 'gauge',
                    startAngle: 90,
                    endAngle: -270,
                    min: 0,
                    max: 100,
                    axisLine: {
                        lineStyle: {
                            width: 7,
                            color: [
                                [value / 100, color],
                                [1, 'rgba(0, 212, 255, 0.1)']
                            ]
                        }
                    },
                    pointer: { show: false },
                    progress: { show: false },
                    axisTick: { show: false },
                    splitLine: { show: false },
                    axisLabel: { show: false },
                    detail: {
                        valueAnimation: true,
                        fontSize: 12,
                        offsetCenter: [0, '0%'],
                        formatter: '{value}%',
                        color: color
                    },
                    data: [{ value: parseFloat(value) }]
                }
            ]
        });

        // Add mouse move particle effect (existing code)
        document.addEventListener('mousemove', function (e) {
            createParticle(e.clientX, e.clientY);
        });

        function createParticle(x, y) {
            const particle = document.createElement('div');
            particle.style.position = 'fixed';
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.width = '2px';
            particle.style.height = '2px';
            particle.style.background = '#00d4ff';
            particle.style.borderRadius = '50%';
            particle.style.pointerEvents = 'none';
            particle.style.zIndex = '1000';
            particle.style.opacity = '0.8';
            document.body.appendChild(particle);

            const animation = particle.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 0.8 },
                { transform: `translate(${Math.random() * 40 - 20}px, ${Math.random() * 40 - 20}px) scale(0)`, opacity: 0 }
            ], {
                duration: 1000,
                easing: 'ease-out'
            });

            animation.onfinish = () => {
                document.body.removeChild(particle);
            };
        }

        // EasyPlayerPro集成
        new Vue({
            el: '#app',
            data() {
                return {
                    videoUrl: "ws://192.168.1.74:9002/live/test.live.mp4",
                    isPlay: false,
                    config: { hasAudio: true, MSE: false, WCS: false, bufferTime: 0.2, stretch: false },
                    screenCount: 1,
                    playerList: [],
                    currentTime: '',
                    selectedScreenId: 0,
                    deviceList: [], // 设备列表数据
                    deviceStats: { // 设备状态统计
                        total: 0,
                        started: 0,
                        online: 0
                    },
                    // 新增的 data 属性，用于存储每个分组的展开状态
                    groupStates: {}
                };
            },
            created() {
                // 在组件创建时初始化 groupStates
                this.initializeGroupStates();
            },
            computed: {
                deviceGroups() {
                    // 按groupid分组
                    const groups = {};
                    // 定义一个特殊的分组ID用于未分组设备
                    const UNGROUPED_ID = 'ungrouped';

                    this.deviceList.forEach(device => {
                        const groupId = device.groupid === 0 ? UNGROUPED_ID : device.groupid; // 0 表示未分组
                        const groupName = device.groupid === 0 ? '未分组' : device.groupname;

                        if (!groups[groupId]) {
                            // 在这里读取 groupStates 中的 expanded 状态
                            const expandedState = this.groupStates[groupId] ? this.groupStates[groupId].expanded : true;
                            groups[groupId] = {
                                id: groupId,
                                name: groupName,
                                devices: [],
                                expanded: expandedState // 这里会从 groupStates 中获取初始状态
                            };
                        }
                        groups[groupId].devices.push(device);
                    });

                    // 将对象转换为数组并进行排序
                    const sortedGroups = Object.values(groups).sort((a, b) => {
                        // 将"未分组"放在列表的最后
                        if (a.id === UNGROUPED_ID) return 1;
                        if (b.id === UNGROUPED_ID) return -1;
                        // 其他分组按 ID 排序
                        return a.id - b.id;
                    });

                    return sortedGroups;
                }
            },
            methods: {
                initializeGroupStates() {
                    const initialStates = {};
                    const uniqueGroupIds = new Set();
                    this.deviceList.forEach(device => {
                        const groupId = device.groupid === 0 ? 'ungrouped' : device.groupid;
                        uniqueGroupIds.add(groupId);
                    });

                    uniqueGroupIds.forEach(id => {
                        // 默认所有分组都是展开的
                        this.$set(initialStates, id, { expanded: true });
                    });
                    this.groupStates = initialStates;
                },
                toggleGroup(groupId) {
                    // 通过 $set 确保 Vue 能够检测到 groupStates 对象属性的变化
                    this.$set(this.groupStates[groupId], 'expanded', !this.groupStates[groupId].expanded);
                    const groupName = this.deviceGroups.find(g => g.id === groupId)?.name || '未知分组';
                    console.log(`分组 "${groupName}" ${this.groupStates[groupId].expanded ? '展开' : '折叠'}`);
                },
                // 获取设备列表数据
                async fetchDeviceList() {
                    try {
                        const response = await fetch('http://192.168.1.186:5000/get_data?token=123456');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const data = await response.json();
                        console.log('获取到的设备数据:', data);

                        // 处理设备数据，确保每个组都有expanded属性
                        const groups = {};
                        data.forEach(device => {
                            const groupId = device.groupid === 0 ? 'ungrouped' : device.groupid;
                            if (!groups[groupId]) {
                                groups[groupId] = {
                                    id: groupId,
                                    name: device.groupid === 0 ? '未分组' : device.groupname,
                                    devices: [],
                                    expanded: true
                                };
                            }
                            groups[groupId].devices.push(device);
                        });

                        // 初始化 groupStates
                        const initialStates = {};
                        Object.keys(groups).forEach(id => {
                            this.$set(initialStates, id, { expanded: true });
                        });
                        this.groupStates = initialStates;

                        this.deviceList = data;
                        this.updateDeviceStats();
                    } catch (error) {
                        console.error('获取设备列表失败:', error);
                    }
                },
                // 更新设备状态统计
                updateDeviceStats() {
                    this.deviceStats.total = this.deviceList.length;
                    this.deviceStats.started = this.deviceList.filter(device => device.started).length;
                    this.deviceStats.online = this.deviceList.filter(device => device.online).length;

                    // 更新仪表盘，添加除数为0的处理
                    const startupPercentage = this.deviceStats.online === 0 ? '0.0' :
                        (this.deviceStats.started / this.deviceStats.online * 100).toFixed(1);
                    const onlinePercentage = this.deviceStats.total === 0 ? '0.0' :
                        (this.deviceStats.online / this.deviceStats.total * 100).toFixed(1);

                    // 更新仪表盘
                    if (window.startupGaugeChart && window.onlineGaugeChart) {
                        window.startupGaugeChart.setOption(createGaugeOption(startupPercentage, '#00d4ff'));
                        window.onlineGaugeChart.setOption(createGaugeOption(onlinePercentage, '#00ff00'));
                    }

                    // 更新设备状态数字
                    const startupText = document.querySelector('.gauge-wrapper:first-child .stat-text');
                    const onlineText = document.querySelector('.gauge-wrapper:last-child .stat-text');

                    if (startupText) {
                        startupText.innerHTML = `
                            <span>启动: ${this.deviceStats.started}</span>
                            <span>待机: ${this.deviceStats.online - this.deviceStats.started}</span>
                        `;
                    }

                    if (onlineText) {
                        onlineText.innerHTML = `
                            <span>在线: ${this.deviceStats.online}</span>
                            <span>离线: ${this.deviceStats.total - this.deviceStats.online}</span>
                        `;
                    }
                },
                // 获取设备状态样式
                getDeviceStatusClass(device) {
                    if (!device.online) return 'status-offline';
                    if (!device.started) return 'status-standby';
                    return 'status-started';
                },
                // 处理设备点击
                handleDeviceClick(device) {
                    if (device.online && device.wsurl) {
                        this.videoUrl = device.wsurl;
                        this.onPlayer();
                    }
                },
                handleScreenClick(screenId) {
                    console.log('选中的屏幕ID:', screenId);
                    this.selectedScreenId = screenId;
                    // 更新选中屏幕的样式
                    document.querySelectorAll('.player-box').forEach((box, index) => {
                        if (index === screenId) {
                            box.style.border = '2px solid #ff0000';
                        } else {
                            box.style.border = '1px solid #00d4ff';
                        }
                    });
                },
                switchScreen(count) {
                    if (this.screenCount === count) return;

                    // 先销毁现有播放器
                    this.playerList.forEach(p => {
                        if (p && p.destroy) {
                            try {
                                p.destroy();
                            } catch (e) {
                                console.warn('销毁播放器时出错:', e);
                            }
                        }
                    });
                    this.playerList = [];
                    this.screenCount = count;
                    this.selectedScreenId = 0; // 重置选中屏幕

                    // 等待DOM更新后再创建新播放器
                    this.$nextTick(() => {
                        setTimeout(() => {
                            this.createPlayers();
                            // 如果之前是播放状态，重新开始播放
                            if (this.isPlay && this.videoUrl) {
                                setTimeout(() => {
                                    this.onPlayer();
                                }, 200);
                            }
                        }, 100);
                    });
                },
                createPlayers() {
                    try {
                        // 确保DOM已经更新
                        this.$nextTick(() => {
                            for (let i = 1; i <= this.screenCount; i++) {
                                const container = document.getElementById('easyplayer-container-' + i);
                                if (container) {
                                    try {
                                        // 确保容器是空的
                                        container.innerHTML = '';
                                        const player = new EasyPlayerPro(container, {
                                            ...this.config,
                                            watermark: {
                                                text: {
                                                    content: 'easyplayer-pro'
                                                },
                                                right: 10,
                                                top: 10
                                            }
                                        });
                                        this.playerList.push(player);
                                    } catch (error) {
                                        console.error(`创建播放器${i}失败:`, error);
                                        this.playerList.push(null);
                                    }
                                }
                            }
                            // 设置初始选中屏幕的样式
                            this.handleScreenClick(0);
                        });
                    } catch (error) {
                        console.error('创建播放器失败:', error);
                    }
                },
                onPlayer() {
                    if (!this.videoUrl) return;

                    try {
                        const selectedPlayer = this.playerList[this.selectedScreenId];
                        if (selectedPlayer) {
                            selectedPlayer.destroy();
                        }

                        this.$nextTick(() => {
                            setTimeout(() => {
                                const container = document.getElementById('easyplayer-container-' + (this.selectedScreenId + 1));
                                if (container) {
                                    try {
                                        // 确保容器是空的
                                        container.innerHTML = '';
                                        const newPlayer = new EasyPlayerPro(container, {
                                            ...this.config,
                                            watermark: {
                                                text: {
                                                    content: 'easyplayer-pro'
                                                },
                                                right: 10,
                                                top: 10
                                            }
                                        });
                                        this.playerList[this.selectedScreenId] = newPlayer;
                                        newPlayer.play(this.videoUrl).catch(e => {
                                            console.error('播放失败', e);
                                        });
                                        this.isPlay = true;
                                    } catch (error) {
                                        console.error('创建播放器实例失败:', error);
                                    }
                                }
                            }, 200);
                        });
                    } catch (error) {
                        console.error('播放器操作失败:', error);
                    }
                },
                onPause() {
                    const selectedPlayer = this.playerList[this.selectedScreenId];
                    if (selectedPlayer && selectedPlayer.pause) {
                        try {
                            selectedPlayer.pause();
                        } catch (error) {
                            console.error('暂停操作失败:', error);
                        }
                    }
                },
                setFullscreen() {
                    const videoSection = document.querySelector('.video-section');
                    if (videoSection) {
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        } else {
                            videoSection.requestFullscreen();
                        }
                    }
                },
                onStop() {
                    const selectedPlayer = this.playerList[this.selectedScreenId];
                    if (selectedPlayer && selectedPlayer.destroy) {
                        try {
                            selectedPlayer.destroy();
                            this.isPlay = false;
                            this.playerList[this.selectedScreenId] = null;

                            setTimeout(() => {
                                const container = document.getElementById('easyplayer-container-' + (this.selectedScreenId + 1));
                                if (container) {
                                    try {
                                        // 确保容器是空的
                                        container.innerHTML = '';
                                        const newPlayer = new EasyPlayerPro(container, {
                                            ...this.config,
                                            watermark: {
                                                text: {
                                                    content: 'easyplayer-pro'
                                                },
                                                right: 10,
                                                top: 10
                                            }
                                        });
                                        this.playerList[this.selectedScreenId] = newPlayer;
                                    } catch (error) {
                                        console.error('创建播放器实例失败:', error);
                                    }
                                }
                            }, 100);
                        } catch (error) {
                            console.error('销毁播放器失败:', error);
                        }
                    }
                },
                updateTime() {
                    const now = new Date();
                    const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
                    this.currentTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${weekdays[now.getDay()]} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                }
            },
            mounted() {
                // 确保DOM完全加载后再初始化
                this.$nextTick(() => {
                    setTimeout(() => {
                        this.createPlayers();
                        this.updateTime();
                        setInterval(this.updateTime, 1000);
                        this.fetchDeviceList();
                        // 每30秒更新一次设备列表
                        setInterval(this.fetchDeviceList, 30000);
                    }, 100);
                });
            },
        });

        // 后台按钮点击事件
        document.querySelector('.back-button').addEventListener('click', function () {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
                window.location.href = 'http://192.168.1.74:9001/control/index';
            }, 150);
        });
    </script>
</body>

</html>